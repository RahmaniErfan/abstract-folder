/* Abstract Folder View Container */
.abstract-folder-view {
    padding: 0;
    margin: 0;
    height: 100%;
    overflow-y: auto;
    position: relative; /* For virtual items */
}

.abstract-folder-virtual-spacer {
    width: 1px;
    position: absolute;
    top: 0;
    z-index: -10;
    pointer-events: none;
}

/* Force the view header to display for the abstract-folder-view type */
.workspace-leaf-content[data-type="abstract-folder-view"] .view-header {
    display: flex !important;
    /* Add any other necessary default header styles if they are missing */
    flex-direction: row !important;
    align-items: center !important;
    justify-content: center !important;
    height: 40px !important; /* Standard header height */
    padding: 0 10px !important; /* Reintroduce standard horizontal padding */
    background-color: var(--background-secondary) !important;
    border-bottom: 1px solid var(--background-modifier-border) !important; /* Main header separation line */
}
/* Ensure the actions container within the header is also displayed and styled */
.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-actions {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important; /* Space between action buttons */
}

.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-header-nav-buttons {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
    min-width: 0 !important;
    overflow: hidden !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
}


.abstract-folder-header-title {
    font-size: var(--font-ui-small); /* Smaller font size */
    font-weight: 400; /* Normal weight for subtlety */
    text-align: center;
    padding: 3px 0 6px 0; /* Further reduced padding */
    margin-bottom: 3px; /* Further reduced margin */
    color: var(--text-muted); /* Make text subtle */
    position: relative; /* For the pseudo-element line */
}

.abstract-folder-header-title::after {
    content: '';
    position: absolute;
    left: 25%; /* Smaller line length */
    right: 25%;
    bottom: 0;
    height: 1px; /* Line thickness */
    background-color: var(--background-modifier-border-hover); /* Slightly lighter border for subtlety */
    opacity: 0.5; /* Even more subtle line */
}



.abstract-folder-tree {
    padding-bottom: 20px;
}

/* Empty State */
.abstract-folder-empty-state {
    padding: 20px;
    text-align: center;
    color: var(--text-muted);
}

/* Tree Item Structure */
.abstract-folder-item {
    /* For tree view: each item is a vertical stack of self + children */
    display: flex;
    flex-direction: column;
}

/* Column View Specific Styles */
.abstract-folder-columns-wrapper {
    display: flex;
    flex-direction: column; /* Stacks columns vertically */
    height: 100%;
    overflow-y: hidden; /* Each column will manage its own scroll */
}

.abstract-folder-columns-container {
    display: flex;
    flex-direction: column; /* Columns stacked vertically */
    flex-grow: 1; /* Take up all available vertical space */
    overflow-y: auto; /* Allow scrolling for the entire container if many columns */
}

.abstract-folder-column {
    flex-shrink: 0; /* Prevent columns from shrinking below content */
    flex-grow: 1; /* Allow columns to grow to fill space */
    border-bottom: 1px solid var(--background-modifier-border); /* Separator between columns */
    padding: 5px 0; /* Vertical padding within each column */
    overflow-y: auto; /* Individual column scrolling */
    min-height: 50px; /* Minimum height for a column */
    max-height: 100%; /* Ensure column doesn't exceed parent */
}

.abstract-folder-column:last-child {
    border-bottom: none; /* No border on the last column */
}

/* Item self for column view, remove any tree-view specific indentation */
.abstract-folder-columns-wrapper .abstract-folder-item-self {
    padding-left: 6px; /* Reset to base padding, effectively removing tree indentation */
}

/* Hide collapse icon in column view */
.abstract-folder-columns-wrapper .abstract-folder-collapse-icon {
    display: none;
}

/* Hide collapse icon in column view */
.abstract-folder-columns-wrapper .abstract-folder-collapse-icon {
    display: none;
}

/* In column view, don't show children containers */
.abstract-folder-columns-wrapper .abstract-folder-children {
    display: none;
}

/* Style for selected item in column view */
.abstract-folder-item-self.is-selected-in-column {
    background-color: var(--nav-item-background-active);
    color: var(--nav-item-text-color-active);
    font-weight: var(--font-medium);
}

/* Ensure selected icon color matches */
.abstract-folder-item-self.is-selected-in-column .abstract-folder-item-icon svg {
    color: var(--nav-item-text-color-active);
}


/* Style for ancestor items in column view */
.abstract-folder-item-self.is-ancestor-of-selected {
    background-color: var(--background-modifier-hover); /* A subtle highlight */
    color: var(--text-normal); /* Keep normal text color */
}

/* Multi-Parent Indicator */
.abstract-folder-multi-parent-indicator {
    /* Removed margin-left: auto as it's now a direct child of a flex container */
    color: var(--text-muted);
    opacity: 0.7;
    font-size: var(--font-ui-smaller);
    display: flex; /* For icon sizing */
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    margin-left: 4px; /* Add some spacing between the text and the icon */
    flex-shrink: 0; /* Prevent from shrinking */
}

.abstract-folder-multi-parent-indicator svg {
    width: 12px;
    height: 12px;
}

/* The clickable row */
.abstract-folder-item-self {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 2px 6px 2px 6px; /* Revert to original padding */
    margin-bottom: 2px; /* Add a small margin between items */
    border-radius: var(--radius-s);
    color: var(--text-normal);
    transition: background-color 0.1s ease-in-out;
    /* Ensure there's space for the icon */
    justify-content: flex-start;
    gap: 4px; /* Space between flex items in this container */
}

.abstract-folder-item-self:hover {
    background-color: var(--nav-item-background-hover);
    color: var(--nav-item-text-color-hover);
}

.abstract-folder-item-self.is-active {
    background-color: var(--nav-item-background-active);
    color: var(--nav-item-text-color-active);
    font-weight: var(--font-medium);
}

/* Collapse Icon */
.abstract-folder-collapse-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    margin-right: 2px;
    color: var(--collapse-icon-color);
    transition: transform 0.1s ease-in-out;
}
.abstract-folder-collapse-icon svg {
    transform: rotate(90deg); /* Default (expanded): chevron-right rotated to point down */
    transition: transform 0.1s ease-in-out;
}

.abstract-folder-item.is-collapsed > .abstract-folder-item-self > .abstract-folder-collapse-icon svg {
    transform: rotate(0deg); /* Collapsed: chevron-right points right */
}

.abstract-folder-collapse-icon:hover {
    color: var(--collapse-icon-color-hover);
}

/* Inner Text */
.abstract-folder-item-inner {
    flex-grow: 1; /* Match native explorer behavior */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-size: 13px; /* Explicitly set to match native */
    font-weight: 400; /* Normal weight to match native */
    line-height: 16.9px; /* Match native */
    color: var(--text-normal); /* Ensure normal text color */
    /* Removed margin-left: auto; which was causing the issue before */
    display: flex; /* Make it a flex container to align its content if needed */
    align-items: center; /* Vertically align content */
}

/* Children Container */
.abstract-folder-children {
    padding-left: 18px; /* Standard indentation */
    border-left: 1px solid var(--nav-indentation-guide-color);
    margin-left: 8px; /* Align guide line with icon center roughly */
}

/* Rainbow Indents */
.abstract-folder-children.rainbow-indent {
    border-left-width: 2px; /* Make it a bit more prominent */
}

/* Classic Palette */
.abstract-folder-children.classic-palette.rainbow-indent-0 { border-left-color: #61afef; } /* Blue */
.abstract-folder-children.classic-palette.rainbow-indent-1 { border-left-color: #c678dd; } /* Purple */
.abstract-folder-children.classic-palette.rainbow-indent-2 { border-left-color: #98c379; } /* Green */
.abstract-folder-children.classic-palette.rainbow-indent-3 { border-left-color: #e6c07b; } /* Yellow */
.abstract-folder-children.classic-palette.rainbow-indent-4 { border-left-color: #e06c75; } /* Red */
.abstract-folder-children.classic-palette.rainbow-indent-5 { border-left-color: #56b6c2; } /* Cyan */
.abstract-folder-children.classic-palette.rainbow-indent-6 { border-left-color: #6a9955; } /* Dark Green */
.abstract-folder-children.classic-palette.rainbow-indent-7 { border-left-color: #d1976a; } /* Orange */
.abstract-folder-children.classic-palette.rainbow-indent-8 { border-left-color: #9f7e69; } /* Brown */
.abstract-folder-children.classic-palette.rainbow-indent-9 { border-left-color: #008080; } /* Teal */

/* Pastel Palette */
.abstract-folder-children.pastel-palette.rainbow-indent-0 { border-left-color: #a7bed3; } /* Light Blue */
.abstract-folder-children.pastel-palette.rainbow-indent-1 { border-left-color: #d1c4e9; } /* Lavender */
.abstract-folder-children.pastel-palette.rainbow-indent-2 { border-left-color: #c8e6c9; } /* Mint Green */
.abstract-folder-children.pastel-palette.rainbow-indent-3 { border-left-color: #ffe0b2; } /* Peach */
.abstract-folder-children.pastel-palette.rainbow-indent-4 { border-left-color: #ffccbc; } /* Coral */
.abstract-folder-children.pastel-palette.rainbow-indent-5 { border-left-color: #bbdefb; } /* Sky Blue */
.abstract-folder-children.pastel-palette.rainbow-indent-6 { border-left-color: #c5e1a5; } /* Light Green */
.abstract-folder-children.pastel-palette.rainbow-indent-7 { border-left-color: #b39ddb; } /* Light Purple */
.abstract-folder-children.pastel-palette.rainbow-indent-8 { border-left-color: #ffb74d; } /* Light Orange */
.abstract-folder-children.pastel-palette.rainbow-indent-9 { border-left-color: #9fa8da; } /* Grey-Blue */

/* Neon Palette */
.abstract-folder-children.neon-palette.rainbow-indent-0 { border-left-color: #00ffff; } /* Aqua */
.abstract-folder-children.neon-palette.rainbow-indent-1 { border-left-color: #ff00ff; } /* Magenta */
.abstract-folder-children.neon-palette.rainbow-indent-2 { border-left-color: #00ff00; } /* Lime */
.abstract-folder-children.neon-palette.rainbow-indent-3 { border-left-color: #ffff00; } /* Bright Yellow */
.abstract-folder-children.neon-palette.rainbow-indent-4 { border-left-color: #ff0000; } /* Red */
.abstract-folder-children.neon-palette.rainbow-indent-5 { border-left-color: #0000ff; } /* Blue */
.abstract-folder-children.neon-palette.rainbow-indent-6 { border-left-color: #a020f0; } /* Electric Purple */
.abstract-folder-children.neon-palette.rainbow-indent-7 { border-left-color: #ff69b4; } /* Hot Pink */
.abstract-folder-children.neon-palette.rainbow-indent-8 { border-left-color: #ffd700; } /* Gold */
.abstract-folder-children.neon-palette.rainbow-indent-9 { border-left-color: #4b0082; } /* Indigo */


/* Hide children when collapsed */
.abstract-folder-item.is-collapsed > .abstract-folder-children {
    display: none;
}

/* File items in tree view don't have collapse icons, add padding to align */
.abstract-folder-tree-wrapper .abstract-folder-item.is-file .abstract-folder-item-self {
    padding-left: 24px; /* 6px padding + 16px icon width + 2px margin */
}

/* Loop detection warning */
.abstract-folder-loop {
    padding: 4px 8px;
    background-color: var(--background-modifier-error-hover);
    color: var(--text-error);
    font-size: var(--font-ui-smaller);
    margin-left: 20px;
    border-radius: 4px;
}

/* Icon Modal Specific Styles */
.abstract-folder-icon-modal .modal-content {
    max-width: 600px; /* Adjust modal width for better icon grid display */
}

.abstract-folder-icon-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); /* Responsive grid */
    gap: 8px;
    padding: 16px; /* Increased padding */
    max-height: 300px; /* Limit height and make scrollable */
    overflow-y: auto;
    border: 1px solid var(--background-modifier-border);
    border-radius: var(--radius-s);
    margin-top: 10px;
}

.abstract-folder-grid-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 12px; /* Increased padding for individual items */
    border-radius: var(--radius-s);
    cursor: pointer;
    background-color: var(--background-secondary);
    transition: background-color 0.1s ease-in-out, border-color 0.1s ease-in-out;
    position: relative;
    --icon-size: 24px; /* Slightly larger icon size in picker */
    border: 1px solid transparent;
}

.abstract-folder-grid-item:hover {
    background-color: var(--background-modifier-hover);
    border-color: var(--interactive-hover);
}

.abstract-folder-grid-item.is-active {
    background-color: var(--interactive-accent);
    color: var(--text-on-accent);
    border-color: var(--interactive-accent);
}

.abstract-folder-grid-item.is-active svg {
    color: var(--text-on-accent);
}

.abstract-folder-no-icons {
    grid-column: 1 / -1; /* Span all columns */
    text-align: center;
    padding: 20px;
    color: var(--text-muted);
    width: 100%; /* Ensure full width usage */
}

.abstract-folder-item-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px; /* Standard icon size */
    height: 16px;
    margin-right: 4px; /* Space between icon and text */
    flex-shrink: 0; /* Prevent icon from shrinking */
    font-size: 14px; /* For emojis */
}

.abstract-folder-item-icon svg {
    width: 100%;
    height: 100%;
}

/* Styles for view header actions (sort, expand/collapse buttons) */
/* Styles for view header actions (sort, expand/collapse buttons) */
/* Increased specificity to ensure override */
.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-actions .view-action {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 28px !important;
    height: 28px !important;
    color: var(--icon-color) !important;
    background-color: transparent !important;
    border: none !important;
    border-radius: var(--radius-s) !important;
    cursor: pointer !important;
    transition: color 0.1s ease-in-out, background-color 0.1s ease-in-out !important;
    box-shadow: none !important;
}

/* Style for disabled buttons in the view header actions */
.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-actions .view-action.is-disabled {
    color: var(--text-muted) !important; /* Grey out the icon */
    cursor: default !important; /* Change cursor to default */
    opacity: 0.5 !important; /* Reduce opacity */
    pointer-events: none !important; /* Disable interaction */
    background-color: transparent !important; /* Ensure background is transparent */
}

.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-actions .view-action.is-disabled:hover {
    background-color: transparent !important; /* No hover effect when disabled */
    color: var(--text-muted) !important; /* Keep icon greyed out on hover when disabled */
}

.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-actions .view-action:hover {
    background-color: var(--background-modifier-hover) !important;
    color: var(--icon-color-hover) !important;
}

.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-actions .view-action svg {
    width: 18px !important;
    height: 18px !important;
    stroke-width: 2px;
}

.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-actions .view-action[aria-label="More options"] {
    display: none !important;
}

/* Hide the bookmark button with extreme prejudice - moved for correct specificity */
.workspace-leaf-content[data-type="abstract-folder-view"] .view-header .view-actions .mod-bookmark {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
    width: 0 !important;
    height: 0 !important;
    min-width: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
}


/* Adjust indentation for "Abstract Folders" title */
.workspace-leaf-content[data-type="abstract-folder-view"] .view-header-left {
    /* Re-enable display of the left header section to allow the icon to show */
    display: none !important; /* Completely hide view-header-left */
    /* Remove other properties as display: none takes precedence */
    /* Hide specific children if they are navigation buttons */
    /* .view-header-nav-buttons will still be hidden by earlier rule if it applies */
}

.workspace-leaf-content[data-type="abstract-folder-view"] .view-header-title-container {
    display: none !important; /* Completely hide the title container to ensure centering of action buttons */
}

.workspace-leaf-content[data-type="abstract-folder-view"] .view-header-title {
    padding: 0 !important; /* Reset padding for the title text itself */
    margin: 0 !important; /* Reset margin for the title text itself */
    flex-grow: 0 !important; /* Prevent title from expanding */
    text-align: left !important; /* Ensure text alignment is left */
}

/* Push view actions to the right when header is flex-start */

/* Folder Indicator for Column View */
.abstract-folder-folder-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    margin-left: auto; /* Push to the right */
    color: var(--text-muted);
    opacity: 0.7;
    flex-shrink: 0;
}

.abstract-folder-folder-indicator svg {
    width: 12px;
    height: 12px;
}

/* Style for multi-selected item - Moved here to override hover/active states if needed */
.abstract-folder-item-self.is-multi-selected {
    background-color: var(--nav-item-background-active); /* Make it look like an active item */
    color: var(--nav-item-text-color-active);
    font-weight: var(--font-medium);
}

.abstract-folder-item-self.is-multi-selected .abstract-folder-item-icon svg {
    color: var(--nav-item-text-color-active);
}

/* High specificity override to ensure column selection is always visible even with other states */
.abstract-folder-view .abstract-folder-item-self.is-selected-in-column {
    background-color: var(--nav-item-background-active) !important;
    color: var(--nav-item-text-color-active) !important;
}

/* Style for file type tag */
.abstract-folder-file-tag {
    align-self: center;
    background-color: rgba(0, 0, 0, 0); /* Transparent background */
    border-radius: 4px;
    color: var(--text-muted); /* Muted text color */
    font-size: 9px; /* Specific font size from example */
    font-weight: 600; /* Specific font weight from example */
    letter-spacing: 0.45px; /* Specific letter spacing from example */
    line-height: 13.5px; /* Specific line height from example */
    padding: 0 4px; /* Specific padding from example */
    text-transform: uppercase; /* Capitalize text */
    flex-shrink: 0; /* Prevent from shrinking */
    margin-inline-start: 8px; /* Space between the file name and the tag */
    display: block; /* Ensure it behaves like a block for full style adherence */
}

.abstract-folder-view .abstract-folder-item-self.is-selected-in-column .abstract-folder-item-icon svg {
    color: var(--nav-item-text-color-active) !important;
}

/* Styles for Conflict Resolution Modal */
.abstract-folder-conflict-container {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 20px;
    max-height: 400px; /* Moved from inline style in modals.ts */
}

.abstract-folder-conflict-item {
    border-bottom: 1px solid var(--background-modifier-border);
    padding: 10px 0;
}

/* Drag and Drop Visual Feedback */
.abstract-folder-drag-over {
    background-color: var(--background-modifier-hover) !important;
    outline: 1px dashed var(--text-muted);
    outline-offset: -2px;
    border-radius: var(--radius-s);
}

.abstract-folder-drag-invalid {
    background-color: rgba(var(--color-red-rgb), 0.15) !important;
    outline: 1px dashed var(--text-muted) !important;
    outline-offset: -2px;
    border-radius: var(--radius-s);
    cursor: no-drop !important;
}

.abstract-folder-ghost-drag-image {
    position: absolute;
    top: -1000px;
    background-color: var(--background-primary);
    border: 1px solid var(--background-modifier-border);
    padding: 4px 8px;
    border-radius: 4px;
    color: var(--text-normal);
    font-size: 12px;
    z-index: -1;
}

.abstract-folder-virtual-item {
    position: absolute;
    width: 100%;
    /* Ensure height is consistent for virtual scrolling calculations */
    /* min-height: 24px; */
}
